[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor
user=root

[program:auth-service]
command=python3 -m gunicorn --config /app/auth_service/gunicorn.conf.py "app:create_app('app.config.ProductionConfig')"
directory=/app/auth_service
environment=DATABASE_URL="%(ENV_DATABASE_URL_AUTH)s",JWT_SECRET="%(ENV_JWT_SECRET)s",INTERNAL_AUTH_TOKEN="%(ENV_INTERNAL_AUTH_TOKEN)s",FLASK_ENV="%(ENV_FLASK_ENV)s",LOG_LEVEL="%(ENV_LOG_LEVEL)s",APP_MODE="production",USER_SERVICE_URL="http://127.0.0.1:5002",PYTHONUNBUFFERED="1"
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=10

[program:identity-service]
command=python3 -m gunicorn --config /app/identity_service/gunicorn.conf.py "app:create_app('app.config.ProductionConfig')"
directory=/app/identity_service
environment=DATABASE_URL="%(ENV_DATABASE_URL_IDENTITY)s",JWT_SECRET="%(ENV_JWT_SECRET)s",INTERNAL_AUTH_TOKEN="%(ENV_INTERNAL_AUTH_TOKEN)s",FLASK_ENV="%(ENV_FLASK_ENV)s",LOG_LEVEL="%(ENV_LOG_LEVEL)s",APP_MODE="production",GUARDIAN_SERVICE_URL="http://127.0.0.1:5003",GUARDIAN_SERVICE_TIMEOUT="10",PYTHONUNBUFFERED="1"
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=11

[program:guardian-service]
command=python3 -m gunicorn --config /app/guardian_service/gunicorn.conf.py "app:create_app('app.config.ProductionConfig')"
directory=/app/guardian_service
environment=DATABASE_URL="%(ENV_DATABASE_URL_GUARDIAN)s",JWT_SECRET="%(ENV_JWT_SECRET)s",INTERNAL_AUTH_TOKEN="%(ENV_INTERNAL_AUTH_TOKEN)s",FLASK_ENV="%(ENV_FLASK_ENV)s",LOG_LEVEL="%(ENV_LOG_LEVEL)s",APP_MODE="production",IDENTITY_SERVICE_URL="http://127.0.0.1:5002",PYTHONUNBUFFERED="1"
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=12

[program:web-service]
command=node /app/web/server.js
directory=/app/web
environment=NODE_ENV="production",NEXT_PUBLIC_AUTH_API_URL="http://127.0.0.1:5001",NEXT_PUBLIC_IDENTITY_API_URL="http://127.0.0.1:5002",NEXT_PUBLIC_GUARDIAN_API_URL="http://127.0.0.1:5003"
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=13

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=20
